



select 

c.SUPPLIER_CBN,wty_REF,wh.STATUS,DECLARED_DATE,PREINVOICED_DATE, m.PREINVOICE_ID, m.CUST_ID  


,m.MONTH ,m.WTY_ID ,m.SUPPLIER_CBN, WH.PRODUCT_NUMBER,  


WH.SERIAL_NUMBER, d.LINE_NUMBER, PART_NUMBER, WD.RMA_NUMBER ,REIMBURSEMENT_FLAG ,QTY,  


m.CURRENCY_CODE, REIMBURSEMENT_AMOUNT, labor_reimbursement ,PREINVOICE_CASE,packing_Ref,WH.ENDUSERPHONECOUNTRY,WH.FAILURE_DATE, WH.DATE_REPAIR, WH.FAILURE_REASON, PL.PRODUCT_LINE_ID, PL.WTY_CODE, WH.OTC 


from  


wizadmin.monitoring_preinvoice m ,wizadmin.preinvoice_Detail d , wizadmin.company_profile c, wizadmin.WTY_HEADER WH, wizadmin.WTY_DETAIL WD, WIZADMIN.PRODUCT_INFO PL 


where m.preinvoice_id =d.preinvoice_id  


and m.cust_ID = c.cust_id and WH.WTY_ID = WD.WTY_ID AND m.wty_id = wh.wty_id  and wd.line_number=d.line_number 


AND d.part_number = wd.part_Declared AND m.cust_id = wh.cust_id  and WH.PRODUCT_NUMBER=PL.PRODUCT_NUMBER 


/* Date must be Updated */

and c.type in ('COMP_ASP','COMP_HP_SP') and month ='201907'  


union  


select c.SUPPLIER_CBN,WTY_REF,wh.STATUS,DECLARED_DATE,PREINVOICED_DATE, null "PREINVOICE_ID", c.CUST_ID  


, null "MONTH" ,wh.WTY_ID ,C.SUPPLIER_CBN, WH.PRODUCT_NUMBER,  


WH.SERIAL_NUMBER, wd.LINE_NUMBER, PART_declared, WD.RMA_NUMBER ,null "REIMBURSEMENT_FLAG" ,null "QTY",  


c.CURRENCY_CODE,null "REIMBURSEMENT_AMOUNT", null "LABOR_REIMBURSEMENT" ,NULL "PREINVOICE_CASE" , packing_Ref, NULL "ENDUSERPHONECOUNTRY", null "FAILURE_DATE", NULL"DATE_REPAIR", Null "FAILURE_REASON", NULL "PRODUCT_LINE_ID", NULL "WTY_CODE", Null "OTC" 


from wizadmin.company_profile c, wizadmin.WTY_HEADER WH, wizadmin.WTY_DETAIL WD  


where WH.WTY_ID =WD.WTY_ID AND C.CUST_ID =WH.CUST_ID  


and c.type in ('COMP_ASP','COMP_HP_SP') and  

/* Date must be updated */

preinvoiced_Date between '01-jul-2019' and '31-jul-2019' AND WH.WTY_ID NOT IN (SELECT WTY_ID FROM wizadmin.MONITORING_PREINVOICE) 
